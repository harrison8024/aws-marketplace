CONNECT TO adpbase ;

SET SCHEMA <username> ;

CREATE TABLE TENANTINFO
      (tenantid varchar(128) NOT NULL,  
      ontology varchar(128) not null,
      tenanttype smallint not null with default,
      dailylimit smallint not null with default 0,
      rdbmsengine varchar(128)  not null, 
      dbname varchar(255) not null,
      dbuser varchar(255) not null,
      bacaversion varchar(1024) not null,
      featureflags bigint not null with default 0,
      tenantdbversion varchar(255),
      last_job_run_time BIGINT not null with default 0,
      dbstatus smallint not null with default 0,
      project_guid VARCHAR(256),
      bas_id VARCHAR(256),
      last_updated_ts timestamp not null generated by default for each row on update as row change timestamp,
      connstring varchar(1024),
      project_type smallint NULL,
      CONSTRAINT tenantinfo_pkey PRIMARY KEY (tenantid, ontology) 
      );

-- Table for aggregated project usage data
-- The table has a primary key on (project_guid, year, month, day_of_month) to be consistent with PG
-- "status" column is reserved for future use
-- "created_ts" is re-purposed for the timestamp of the last aggregated document

CREATE TABLE project_usage
      (project_guid VARCHAR(256) NOT NULL,
      num_docs  integer NOT NULL,
      num_pages integer NOT NULL,
      year SMALLINT NOT NULL,
      month SMALLINT NOT NULL,
      day_of_month SMALLINT NOT NULL,
      day_of_week SMALLINT NOT NULL,
      status smallint,
      created_ts timestamp NOT NULL,
      CONSTRAINT project_usage_pkey PRIMARY KEY (project_guid, year, month, day_of_month)
      );

CREATE TABLE base_options
(
      schema_version  varchar(255),
      flags bigint not null with default 0
);

-- Put a placeholder for the schema_version. The version will be updated by a common function
INSERT INTO base_options(schema_version) values('24.0.0');

CONNECT RESET;